#!/usr/bin/env bash
#
# Script to set colors generated by 'wal'
# https://github.com/dylanaraps/wal
#
# Modified by 0xelectron
#


# Source generated colors.
source "${HOME}/.cache/wal/colors.sh"

# Update dunst to reflect pywall colors
reload_dunst() {
    killall -wq dunst
    dunst \
        -lb "$color0" \
        -nb "$color0" \
        -cb "$color0" \
        -lf "$color15" \
        -bf "$color15" \
        -cf "$color15" \
        -nf "$color15" \
        -fn "${DUNST_FONT:- Roboto 11}" \
        -geometry "${DUNST_SIZES:-300x30-40+70}" &
}

# Restart polybar
# set_bar() {
    # ${HOME}/.config/scripts/polybar.sh 2>/dev/null &
# }

# Update gtk theme to reflect pywall colors inspired from following script:
# https://github.com/himidori/linux_cfgs/blob/master/gengtk
# You'll also need to install oomox and acyl for it to work. Also, should be
# in path
# https://github.com/actionless/oomox
# https://github.com/neeasade/acyl
set_gtk() {

    background="$color0"
    background=${background:1}
    foreground="$color14"
    foreground=${foreground:1}

    oomoxconf="/tmp/autotheme"

    cat <<- HEREDOC > $oomoxconf
    NAME="autotheme"
    BG=$background
    FG=$foreground
    TXT_BG=$background
    TXT_FG=$foreground
    MENU_BG=$background
    MENU_FG=$foreground
    SEL_BG=$foreground
    SEL_FG=$background
    BTN_BG=$background
    BTN_FG=$foreground
HEREDOC

    oomox-cli $oomoxconf
    icon.sh "#$foreground"

    sed -i 's/-/_/g' ~/.gtkrc-2.0
    . ~/.gtkrc-2.0 2>&1
    rm ~/.gtkrc-2.0

    gtk_theme_name=oomox-$(basename $oomoxconf)
    gtk_icon_theme_name=acyl
    gtkvars=(theme-name icon-theme-name font-name cursor-theme-name cursor-theme-size toolbar-style toolbar-icon-size button-images menu-images enable-event-sounds enable-input-feedback-sounds xft-antialias xft-hinting xft-hintstyle xft-rgba)

    for i in "${gtkvars[@]}"; do
        value="$(eval echo \$`echo gtk-$i | sed 's/-/_/g'`)"
        echo "gtk-$i=\"$value\"" >> ~/.gtkrc-2.0
    done

    gtkrc-reload
}

main() {
    reload_dunst &
    # set_bar &
    set_gtk &
}

main > /dev/null 2>&1
